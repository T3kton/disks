#!/bin/sh
#SOURCE: https://mirrors.edge.kernel.org/pub/linux/utils/raid/mdadm/mdadm-4.3.tar.xz
#HASH: fb0bace919325b42a005372b5a5cfa999da6567a

set -e
#set -x

# sed is to fix a error introduced in gcc 7.1
# would be nice to do the CROSS_COMPILE=arm-linux-gnueabihf- instad of CC=arm-linux-gnueabihf-gcc
build()
{
  tar --strip-components=1 -xJf $1
  sed 's@-Werror@@' -i Makefile
  if [ "x$2" = "xx86_64" ]
  then
    make $3
  elif [ "x$2" = "xarm" ]
  then
    make CC=arm-linux-gnueabihf-gcc $3
  elif [ "x$2" = "xarm64" ]
  then
    make CC=aarch64-linux-gnu-gcc $3
  fi
}

install()
{
  cp -f $3/mdadm $1/sbin
}

binaries()
{
  ls $1/sbin/mdadm*
}
