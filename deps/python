#!/bin/sh
#SOURCE: https://www.python.org/ftp/python/3.6.3/Python-3.6.3.tar.xz
#FILE: Python-3.6.3.tar.xz
#HASH: 6c71b14bdbc4d8aa0cfd59d4b6dc356d46abfdf5

set -e
set -x

build()
{
  tar --strip-components=1 -xJf $1
  ./configure --prefix= --enable-ipv6
  make -j4 python
  # see notes in setup_base
  LIBSUBDIRS="encodings serial json config ctypes logging sqlite3 lib2to3" make -e build_all
}

install()
{
  cp -f $3/python/python $1/bin/
  # we don't need everything, so only these subdirs
  # lib2to3 is there b/c the install with out it, going to remove that later
  DESTDIR=$1 LIBSUBDIRS="encodings serial json config ctypes logging sqlite3 lib2to3" make -C $3/python -e libinstall
  DESTDIR=$1 LIBSUBDIRS="encodings serial json config ctypes logging sqlite3 lib2to3" make -C $3/python -e sharedinstall

  rm -fr $1/lib/python3.6/lib2to3
  rm $1/bin/2to3-3.6
  rm $1/bin/idle3.6
  rm $1/bin/pydoc3.6
  rm $1/bin/pyvenv-3.6
  #find $1/lib/ -name *.py -exec rm {} \;  # python3 dosen't let us use the the compiled files? would be nice to get rid of uncompiled source, it takes up a lot of space

  ln -sf python $1/bin/python3
}
