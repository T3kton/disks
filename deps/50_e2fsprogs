#!/bin/sh
#SOURCE: https://mirrors.edge.kernel.org/pub/linux/kernel/people/tytso/e2fsprogs/v1.46.5/e2fsprogs-1.46.5.tar.gz
#FILE: e2fsprogs-1.46.5.tar.gz
#HASH: 6639cc77856bd1f3b5600c150c3ffa640d20b64b

set -e
#set -x

build()
{
  tar --strip-components=1 -xzf $1
  if [ "x$3" = "xx86_64" ]
  then
    ./configure --prefix=/ --disable-nls
  elif [ "x$3" = "xarm" ]
  then
    ./configure --prefix=/ --disable-nls --host arm-linux-gnueabihf --build x86_64-pc-linux-gnu
  elif [ "x$3" = "xarm64" ]
  then
    ./configure --prefix=/ --disable-nls --host aarch64-linux-gnu --build x86_64-pc-linux-gnu
  fi
  make $4
}

install()
{
  cp -f $3/misc/mke2fs $1/sbin/mkfs.ext2
  ln -sf mkfs.ext2 $1/sbin/mkfs.ext3
  ln -sf mkfs.ext2 $1/sbin/mkfs.ext4
  cp -f $3/e2fsck/e2fsck $1/sbin/fsck.ext2
  ln -sf fsck.ext2 $1/sbin/fsck.ext3
  ln -sf fsck.ext2 $1/sbin/fsck.ext4
  cp -f $3/misc/tune2fs $1/sbin
  cp -f $3/misc/dumpe2fs $1/sbin
}

binaries()
{
  ls $1/sbin/fsck.ext2
  ls $1/sbin/mkfs.ext3
  ls $1/sbin/tune2fs
  ls $1/sbin/dumpe2fs
}
