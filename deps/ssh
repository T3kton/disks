#!/bin/sh
#SOURCE: https://cloudflare.cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-7.7p1.tar.gz
#FILE: openssh-7.7p1.tar.gz
#HASH: 446fe9ed171f289f0d62197dffdbfdaaf21c49f2

set -e
set -x

# this patch is only for openssh 7.7 to openssl 1.1.0, hopfully openssh get's fixed soon
build()
{
  tar --strip-components=1 -xzf $1
  patch -Np1 -i ../../configs/ssh.patch
  ./configure --prefix= --sysconfdir=/etc/ssh --with-md5-passwords --with-privsep-path=/var/empty
  make
}

install()
{
  for LIB in /usr/lib/x86_64-linux-gnu/libcrypto.so.1.1 \
  /lib/x86_64-linux-gnu/libz.so.1.2.11
  do
    cp -L $LIB $1/lib
  done

  cp -f $3/sshd $1/sbin
  cp -f $3/sftp-server $1/sbin
  cp -f $3/ssh-keygen $1/sbin
}
