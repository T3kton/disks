{% load jsonify %}
{% load shellify %}
# {{ config_description }}
# Generated at: {{ timestamp }}
# Config Profile: {{ profile }}

{% if image_package %}
PACKAGE="{{ image_package }}"
SOURCE="{{ resource_location }}"
{% else %}
DISTRO="{{ distro }}"
VERSION="{{ distro_version }}"
SOURCE="{{ bootstrap_source }}"
{% endif %}

cat > /config.json << CONFIG_EOF
{
"root_pass":"{{ root_pass|shellify }}",
"repo_list":{{ repo_list|jsonify }},
"packages":"{{ packages }}",
"swap_size":"{{ swap_size }}",
"mounting_options":"{{ mounting_options }}",
"partition_scheme":"{{ partition_scheme|default:'single' }}",
"target_drives": {{ target_disks|jsonify }},
"partition_recipe": {{ partition_recipe|jsonify }}
}
CONFIG_EOF

{% if before_packages_task %}
echo "#!/bin/sh" > /before.sh
cat >> /before.sh << BEFORE_EOF
{{ before_packages_task|safe }}
BEFORE_EOF
chmod +x /before.sh
{% endif %}

{% if after_packages_task %}
echo "#!/bin/sh" > /after.sh
cat >> /after.sh << AFTER_EOF
{{ after_packages_task|safe }}
AFTER_EOF
chmod +x /after.sh
{% endif %}

